srcdir = @srcdir@
target_alias = @target_alias@
target_triplet = @target_triplet@

site.exp:
	@echo "Making a new config file..."
	@test ! -f site.bak || rm -f site.bak
	@echo "## these variables are automatically generated by make ##" > $@-t
	@echo "# Do not edit here. If you wish to override these values" >> $@-t
	@echo "# add them to the last section" >> $@-t
	@echo "set srcdir $(srcdir)/qemu/testsuite" >> $@-t
	@echo "set objdir ./" >> $@-t
	@echo "set tmpdir ./tmp" >> $@-t
	@echo "set target_alias $(target_alias)" >> $@-t
	@echo "set target_triplet $(target_triplet)" >> $@-t
	@test ! -f site.exp || sed '1./^## All variables above are.*##/ d' site.exp >> $@-t
	@test ! -f site.exp || mv site.exp site.bak
	@mv $@-t site.exp

check: site.exp
	@if [ -d tmp ] ; then \
	  true ; \
	else \
	  mkdir tmp ; \
	fi
	runtest --tool qemu $(RUNTESTFLAGS) || true
